<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Listenansicht SuS-Status</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="bs_cal2_calendar-container">
        <button class="bs_cal2_arrow" id="prev" type="button">&lt;</button>
        <div class="bs_cal2_calendar" id="calendar"></div>
        <button class="bs_cal2_arrow" id="next" type="button">&gt;</button>
    </div>

    <!-- Hidden Div with Date Ranges -->
    <div class="hidden">
        <div class="bs_data-ranges">4. Februar 2025 - 11. Februar 2025 | 14. Februar 2025 - 15. Februar 2025 | 2. M채rz
            2025 -
            11. M채rz 2025</div>
        <div class="bs_data-user"><a href="https://lms.lernen.hamburg/user/view.php?id=110087&amp;course=217256">Hannes
                Wader</a></div>
        <div class="bs_data-ranges">2. Februar 2025 - 11. Februar 2025 | 16. Februar 2025 - 30. M채rz 2025</div>
        <div class="bs_data-user"><a href="https://lms.lernen.hamburg/user/view.php?id=110088&amp;course=217256">Ali
                Mirkovic</a></div>

        <!-- <div class="bs_data-ranges">[[Anfang1]] - [[Ende1]] | [[Anfang2]] - [[Ende2]] | [[Anfang3]] - [[Ende3]] | [[Anfang4]] -
            [[Ende4]] | [[Anfang5]] - [[Ende5]] | [[Anfang6]] - [[Ende6]] | [[Anfang7]] - [[Ende7]] | [[Anfang8]] - [[Ende8]] |
            [[Anfang9]] - [[Ende9]] | [[Anfang10]] - [[Ende10]] | [[Anfang11]] - [[Ende11]] | [[Anfang12]] - [[Ende12]] |
            [[Anfang13]] - [[Ende13]]</div> -->

        <!-- <div class="bs_data-user">##user## - ##edit## - ##more## - [[Name]] - [[Wunschberufe]] - [[Begr체ndung]]</div> -->

        <!-- <div class="bs_data-user">Hannes Wader</div> -->

        <!-- <div class="bs_data-infos">[[Beruf1]] - [[Kontakt1]] | [[Beruf2]] - [[Kontakt2]] | [[Beruf3]] - [[Kontakt3]] |
        [[Beruf4]] - [[Kontakt4]] |
        [[Beruf5]] - [[Kontakt5]] | [[Beruf6]] - [[Kontakt6]] | [[Beruf7]] - [[Kontakt7]] | [[Beruf8]] -
        [[Kontakt8]] |
        [[Beruf9]] - [[Kontakt9]] | [[Beruf10]] - [[Kontakt10]] | [[Beruf11]] - [[Kontakt11]] | [[Beruf12]] -
        [[Kontakt12]] | [[Beruf13]] - [[Kontakt13]]</div> -->
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
                initializeCalendar();
            });

            function initializeCalendar() {
                const calendar = document.getElementById("calendar");
                const today = new Date();

                let startDate = new Date();
                startDate.setDate(today.getDate() - 7);
                let endDate = new Date();
                endDate.setDate(today.getDate() + 28);

                let fixedContainerCreated = false;

                function parseDateRange(text) {
                    return text.split('|').map(range => {
                        const [start, end] = range.trim().split(' - ');
                        return [new Date(start), new Date(end)];
                    });
                }

                function generateCalendar(start, end) {
                    // Clear only the dynamic calendar content, not the fixedContainer
                    Array.from(calendar.children).forEach(child => {
                        if (!child.classList.contains("bs_cal2_fixed-left")) {
                            calendar.removeChild(child);
                        }
                    });

                    let current = new Date(start);
                    let lastMonth = null;
                    let lastYear = null;
                    let monthContainer = null;

                    const allDataRanges = Array.from(document.querySelectorAll(".bs_data-ranges"))
                        .map(div => parseDateRange(div.innerText));

                    const allUserNames = Array.from(document.querySelectorAll(".bs_data-user a"))
                        .map(a => a.innerText);

                    while (current <= end) {
                        let monthName = current.toLocaleDateString("de-DE", { month: "long", year: "numeric" });

                        if (current.getMonth() !== lastMonth || current.getFullYear() !== lastYear) {
                            monthContainer = document.createElement("div");
                            monthContainer.classList.add("bs_cal2_month-container");

                            if (lastMonth !== null) {
                                monthContainer.style.marginLeft = "5px";
                            }

                            const monthRow = document.createElement("div");
                            monthRow.classList.add("bs_cal2_row");
                            let monthCell = document.createElement("div");
                            monthCell.classList.add("bs_cal2_cell", "bs_cal2_month-header");
                            monthCell.innerText = monthName;
                            monthRow.appendChild(monthCell);
                            monthContainer.appendChild(monthRow);

                            const weekdayRow = document.createElement("div");
                            weekdayRow.classList.add("bs_cal2_row");
                            monthContainer.appendChild(weekdayRow);

                            const dateRow = document.createElement("div");
                            dateRow.classList.add("bs_cal2_row");
                            monthContainer.appendChild(dateRow);

                            allDataRanges.forEach(() => {
                                const dataRow = document.createElement("div");
                                dataRow.classList.add("bs_cal2_data-row");
                                monthContainer.appendChild(dataRow);
                            });

                            calendar.appendChild(monthContainer);

                            if (!fixedContainerCreated) {
                                const fixedContainer = document.createElement("div");
                                fixedContainer.classList.add("bs_cal2_fixed-left");

                                const monthHeight = document.createElement("div");
                                monthHeight.classList.add("bs_cal2_month-height");
                                monthHeight.innerHTML = "Name";

                                const rowHeight = document.createElement("div");
                                rowHeight.classList.add("bs_cal2_row-height");

                                const dateHeight = document.createElement("div");
                                dateHeight.classList.add("bs_cal2_date-height");

                                // Append the same cells to the fixedContainer
                                fixedContainer.appendChild(monthHeight);
                                fixedContainer.appendChild(rowHeight);
                                fixedContainer.appendChild(dateHeight);

                                allUserNames.forEach(userName => {
                                    const userRow = document.createElement("div");
                                    userRow.classList.add("bs_cal2_data-height");
                                    userRow.innerHTML = userName; // Insert user name
                                    fixedContainer.appendChild(userRow);
                                });

                                calendar.appendChild(fixedContainer);
                                fixedContainerCreated = true;
                            }

                            lastMonth = current.getMonth();
                            lastYear = current.getFullYear();
                        }

                        let weekdayCell = document.createElement("div");
                        weekdayCell.classList.add("bs_cal2_cell", "bs_cal2_weekday");
                        weekdayCell.innerText = current.toLocaleDateString("de-DE", { weekday: "short" });

                        let dateCell = document.createElement("div");
                        dateCell.classList.add("bs_cal2_cell", "bs_cal2_date");
                        dateCell.innerText = current.getDate().toString().padStart(2, "0");

                        let isWeekend = current.getDay() === 6 || current.getDay() === 0;

                        if (isWeekend) {
                            weekdayCell.classList.add("bs_cal2_weekend");
                            dateCell.classList.add("bs_cal2_weekend");
                        }

                        if (current.toDateString() === today.toDateString()) {
                            dateCell.classList.add("bs_cal2_today");
                        }

                        monthContainer.children[1].appendChild(weekdayCell);
                        monthContainer.children[2].appendChild(dateCell);

                        allDataRanges.forEach((dataRanges, index) => {
                            let dataCell = document.createElement("div");
                            dataCell.classList.add("bs_cal2_cell");

                            if (isWeekend) {
                                dataCell.classList.add("bs_cal2_weekend");
                            }

                            dataRanges.forEach(([rangeStart, rangeEnd]) => {
                                if (current >= rangeStart && current <= rangeEnd) {
                                    dataCell.classList.add(isWeekend ? "bs_cal2_range-weekend" : "bs_cal2_range");
                                }
                            });

                            monthContainer.children[3 + index].appendChild(dataCell);
                        });

                        current.setDate(current.getDate() + 1);
                    }
                }

                generateCalendar(startDate, endDate);

                document.getElementById("prev").addEventListener("click", () => {
                    startDate.setDate(startDate.getDate() - 7);
                    endDate.setDate(endDate.getDate() - 7);
                    generateCalendar(startDate, endDate);
                });

                document.getElementById("next").addEventListener("click", () => {
                    startDate.setDate(startDate.getDate() + 7);
                    endDate.setDate(end(endate.getdate() + 7));
                    generateCalendar(startdate, enddate);
                });
            }
    </script>
</body>

</html>